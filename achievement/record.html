<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç°å®RPGä»ªè¡¨ç›˜</title>
  <style>
    body {
      font-family: "Helvetica Neue", sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
      display: grid;
      grid-template-columns: 2fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 10px;
      height: 100vh;
    }
    .section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      overflow: auto;
    }
    #daily-tasks {
      grid-column: 1 / 2;
      grid-row: 1 / 3;
    }
    #training-calendar {
      grid-column: 2 / 3;
      grid-row: 1 / 2;
    }
    #roleplay-mode {
      grid-column: 2 / 3;
      grid-row: 2 / 3;
    }
    h2 {
      margin-top: 0;
    }
    .task {
      margin-bottom: 10px;
      transition: all 0.3s ease;
      padding: 8px;
      border-radius: 6px;
      background: #f9f9f9;
    }
    .task.completed {
      opacity: 0.7;
      text-decoration: line-through;
      background: #e8e8e8;
    }
    .task:hover {
      transform: translateX(5px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }
    .calendar-day {
      padding: 10px 5px;
      text-align: center;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      min-height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .calendar-day:hover {
      transform: scale(1.05);
    }
    .calendar-day.completed {
      background: #b2fab4;
    }
    .calendar-day.rest-day {
      background: #a2c4f9;
    }
    .calendar-day.sick {
      background: #f9cb9c;
    }
    .calendar-day.travel {
      background: #d5a6bd;
    }
    .calendar-day.not-completed {
      background: #f4cccc;
    }
    .calendar-day.empty {
      background: transparent;
      cursor: default;
    }
    .role {
      margin-bottom: 10px;
      background: #f0f0f0;
      padding: 15px;
      border-radius: 8px;
      transition: all 0.3s;
    }
    .role:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .achievement {
      margin: 10px 0;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 6px;
      border-left: 4px solid #ddd;
    }
    .achievement.completed {
      border-left-color: #6aa84f;
      background: #eaf7e6;
    }
    .progress-bar {
      height: 10px;
      background: #e0e0e0;
      border-radius: 5px;
      margin-top: 5px;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      background: #6aa84f;
      width: 0%;
      transition: width 0.5s;
    }
    .calendar-navigation {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      align-items: center;
    }
    .calendar-title {
      font-weight: bold;
    }
    .calendar-details {
      margin-top: 15px;
      padding: 15px;
      background: #f0f0f0;
      border-radius: 8px;
      min-height: 50px;
    }
    .calendar-detail-item {
      margin-bottom: 10px;
    }
    .edit-btn {
      background: #6aa84f;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 3px 8px;
      margin-left: 10px;
      cursor: pointer;
      font-size: 12px;
    }
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background-color: #f00;
      opacity: 0;
      animation: confetti 5s ease-in-out;
      z-index: 1000;
    }
    @keyframes confetti {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(1000px) rotate(720deg);
        opacity: 0;
      }
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 999;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      max-width: 80%;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .modal h2 {
      color: #6aa84f;
      margin-bottom: 15px;
    }
    .close-modal {
      margin-top: 20px;
      padding: 8px 20px;
      background: #6aa84f;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .role-journal {
      margin-top: 15px;
    }
    .journal-textarea {
      width: 100%;
      height: 100px;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    .save-journal {
      background: #6aa84f;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      cursor: pointer;
    }
    .journal-entry {
      background: #f9f9f9;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      border-left: 3px solid #6aa84f;
    }
    .journal-date {
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="section" id="daily-tasks">
    <h2>ğŸ¯ æ—¥å¸¸ä»»åŠ¡ï¼ˆä»Šæ—¥æ€»åˆ†ï¼š<span id="total-score">0</span>/100ï¼‰</h2>
    <div id="tasks-container"></div>
    
    <h2>ğŸ† æˆå°±ç³»ç»Ÿ</h2>
    <div id="achievements-container"></div>
  </div>

  <div class="section" id="training-calendar">
    <div class="calendar-navigation">
      <button id="prev-month">â† ä¸Šä¸ªæœˆ</button>
      <div class="calendar-title" id="calendar-title"></div>
      <button id="next-month">ä¸‹ä¸ªæœˆ â†’</button>
    </div>
    <div class="calendar" id="calendar"></div>
    <div class="calendar-details" id="calendar-details">
      <p>ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹è¯¦æƒ…</p>
    </div>
  </div>

  <div class="section" id="roleplay-mode">
    <h2>ğŸ­ ä»Šæ—¥è§’è‰²æ‰®æ¼”</h2>
    <div id="role-container"></div>
    <div class="role-journal">
      <h3>è§’è‰²æ‰®æ¼”æ—¥å¿—</h3>
      <textarea class="journal-textarea" id="role-journal-text" placeholder="è®°å½•ä»Šå¤©çš„è§’è‰²æ‰®æ¼”ä½“éªŒ..."></textarea>
      <button class="save-journal" id="save-journal-btn">ä¿å­˜æ—¥å¿—</button>
      <div id="journal-entries"></div>
    </div>
  </div>

  <div class="modal" id="completion-modal">
    <div class="modal-content">
      <h2>ğŸ‰ ä»»åŠ¡å®Œæˆï¼</h2>
      <p>æ­å–œä½ å®Œæˆäº†ä»Šæ—¥çš„æ‰€æœ‰ä»»åŠ¡ï¼ç»§ç»­ä¿æŒï¼</p>
      <button class="close-modal" onclick="document.getElementById('completion-modal').style.display='none'">å…³é—­</button>
    </div>
  </div>

  <script>
    // ------------------------ ä»»åŠ¡åº“ä¸æŠ½å– ------------------------
    const taskPool = {
      10: [
        "åš10åˆ†é’Ÿå†¥æƒ³", "å–è¶³8æ¯æ°´", "æ•´ç†æˆ¿é—´10åˆ†é’Ÿ", "é˜…è¯»10é¡µä¹¦", "å†™3æ¡æ„Ÿæ©æ¸…å•", 
        "ç«™ç«‹å·¥ä½œ30åˆ†é’Ÿ", "æ¸…ç†1ä¸ªæ‚ç‰©åŒº", "åš10åˆ†é’Ÿä¼¸å±•è¿åŠ¨", "è®°å½•ä»Šæ—¥é¥®é£Ÿ", 
        "å­¦ä¹ 10ä¸ªæ–°å•è¯", "ç»™æ¤ç‰©æµ‡æ°´", "æ•´ç†ç”µè„‘æ¡Œé¢", "æ¸…ç†æ‰‹æœºæ— ç”¨ç…§ç‰‡",
        "ç»ƒä¹ 10åˆ†é’Ÿä¹¦æ³•", "å¬ä¸€é¦–æ–°æ­Œå¹¶è®°å½•æ„Ÿå—", "ç»™å®¶äººå‘é—®å€™ä¿¡æ¯",
        "è®°å½•3ä»¶å¼€å¿ƒå°äº‹", "æ•´ç†è¡£æŸœ10åˆ†é’Ÿ", "å­¦ä¹ ä¸€ä¸ªç”Ÿæ´»å°æŠ€å·§"
      ],
      20: [
        "å®Œæˆä¸€æ¬¡åŠ›é‡è®­ç»ƒ", "æ·±åº¦å·¥ä½œ1å°æ—¶", "å­¦ä¹ æ–°çŸ¥è¯†30åˆ†é’Ÿ", "å‡†å¤‡å¥åº·ä¸‰é¤", 
        "æ•´ç†é‚®ä»¶å’Œæ—¥ç¨‹", "å®Œæˆ30åˆ†é’Ÿæœ‰æ°§è¿åŠ¨", "å­¦ä¹ ä¸€é¡¹æ–°æŠ€èƒ½1å°æ—¶", 
        "å†™ä¸€ç¯‡500å­—æ–‡ç« ", "å®Œæˆä¸€é¡¹å®¶åŠ¡å¤§æ‰«é™¤", "è§„åˆ’ä¸‹å‘¨ç›®æ ‡", 
        "ç ”ç©¶ä¸€ä¸ªæ–°è¯é¢˜", "å®Œæˆä¸€ä¸ªåˆ›æ„é¡¹ç›®", "ç»ƒä¹ ä¹å™¨30åˆ†é’Ÿ", 
        "åˆ¶ä½œå¥åº·é›¶é£Ÿ", "æ•´ç†è´¢åŠ¡è®°å½•", "å­¦ä¹ çƒ¹é¥ªä¸€é“æ–°èœ",
        "å®Œæˆä¸€é¡¹DIYé¡¹ç›®", "ç»ƒä¹ æ¼”è®²æˆ–è¡¨è¾¾30åˆ†é’Ÿ", "å®Œæˆä¸€é¡¹å¿—æ„¿è€…å·¥ä½œ"
      ],
      30: [
        "å®Œæˆä¸€é¡¹é‡è¦ä»»åŠ¡", "åˆ¶å®šæœ¬å‘¨è®¡åˆ’å¹¶å¤ç›˜", "è®°å½•å¹¶åæ€1ä¸ªæƒ…ç»ªæ³¢åŠ¨",
        "å®Œæˆä¸€ä¸ªé•¿æœŸé¡¹ç›®é˜¶æ®µ", "è§£å†³ä¸€ä¸ªæ£˜æ‰‹é—®é¢˜", "è¿›è¡Œæ·±åº¦è‡ªæˆ‘åæ€",
        "å®ŒæˆèŒä¸šå‘å±•è§„åˆ’", "å»ºç«‹ä¸€ä¸ªæ–°çš„å¥åº·ä¹ æƒ¯", "å®Œæˆä¸€é¡¹é‡å¤§å†³ç­–",
        "å¸®åŠ©ä»–äººè§£å†³ä¸€ä¸ªé‡è¦é—®é¢˜", "å®Œæˆä¸€é¡¹åˆ›æ„ä½œå“", "çªç ´ä¸€ä¸ªä¸ªäººæé™",
        "å®Œæˆä¸€é¡¹å­¦ä¹ æŒ‘æˆ˜", "å»ºç«‹ä¸€ä¸ªæ–°çš„ç¤¾äº¤å…³ç³»", "å®Œæˆä¸€é¡¹è´¢åŠ¡è§„åˆ’"
      ],
      40: [
        "å®Œæˆä¸€ä¸ªé‡Œç¨‹ç¢‘ç›®æ ‡", "çªç ´ä¸€ä¸ªé•¿æœŸéšœç¢", "å®ç°ä¸€ä¸ªé‡è¦äººç”Ÿç›®æ ‡",
        "å®Œæˆä¸€é¡¹é‡å¤§åˆ›ä½œ", "è§£å†³ä¸€ä¸ªå¤æ‚é—®é¢˜", "å®Œæˆä¸€é¡¹é•¿æœŸå­¦ä¹ è®¡åˆ’"
      ]
    };

    // è·å–ä»Šå¤©çš„æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆç”¨äºç¡®å®šæ¯æ—¥å›ºå®šä»»åŠ¡ï¼‰
    function getTodayKey() {
      const today = new Date();
      return `${today.getFullYear()}-${today.getMonth()+1}-${today.getDate()}`;
    }

    // ä»æœ¬åœ°å­˜å‚¨è·å–æˆ–ç”Ÿæˆä»Šæ—¥ä»»åŠ¡
    function getDailyTasks() {
      const todayKey = getTodayKey();
      const savedTasks = localStorage.getItem('dailyTasks');
      
      if (savedTasks) {
        const parsed = JSON.parse(savedTasks);
        if (parsed.date === todayKey) {
          return parsed.tasks;
        }
      }
      
      // ç”Ÿæˆæ–°ä»»åŠ¡
      const tasks = generateRandomTasks();
      localStorage.setItem('dailyTasks', JSON.stringify({
        date: todayKey,
        tasks: tasks
      }));
      return tasks;
    }

    // ç”Ÿæˆéšæœºä»»åŠ¡
    function generateRandomTasks() {
      const result = [];
      const used = new Set();

      function pickRandom(arr) {
        let choice;
        do {
          choice = arr[Math.floor(Math.random() * arr.length)];
        } while (used.has(choice));
        used.add(choice);
        return choice;
      }

      const tasks10 = Array.from({length: 3}, () => pickRandom(taskPool[10]));
      const tasks20 = Array.from({length: 2}, () => pickRandom(taskPool[20]));
      const tasks30 = [pickRandom(taskPool[30])];
      return [
        ...tasks10.map(t => ({ desc: t, points: 10, completed: false })),
        ...tasks20.map(t => ({ desc: t, points: 20, completed: false })),
        ...tasks30.map(t => ({ desc: t, points: 30, completed: false }))
      ];
    }

    // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
    function renderTasks() {
      const tasks = getDailyTasks();
      const container = document.getElementById("tasks-container");
      container.innerHTML = '';
      
      let totalScore = 0;
      let completedTasks = 0;

      tasks.forEach(task => {
        const div = document.createElement("div");
        div.className = `task ${task.completed ? 'completed' : ''}`;
        div.innerHTML = `
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="checkbox" ${task.completed ? 'checked' : ''} 
              onchange="updateTaskCompletion(${task.points}, this, '${task.desc.replace(/'/g, "\\'")}')" 
              style="margin-right: 10px;">
            <span>${task.desc}ï¼ˆ${task.points}åˆ†ï¼‰</span>
          </label>
        `;
        container.appendChild(div);
        
        if (task.completed) {
          totalScore += task.points;
          completedTasks++;
        }
      });
      
      document.getElementById("total-score").innerText = totalScore;
      
      // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰ä»»åŠ¡
      if (completedTasks === tasks.length && tasks.length > 0) {
        celebrateCompletion();
      }
    }

    // æ›´æ–°ä»»åŠ¡å®ŒæˆçŠ¶æ€
    function updateTaskCompletion(points, checkbox, desc) {
      const todayKey = getTodayKey();
      const saved = JSON.parse(localStorage.getItem('dailyTasks'));
      const tasks = saved.tasks;
      
      const taskIndex = tasks.findIndex(t => t.desc === desc);
      if (taskIndex !== -1) {
        tasks[taskIndex].completed = checkbox.checked;
        localStorage.setItem('dailyTasks', JSON.stringify({
          date: todayKey,
          tasks: tasks
        }));
      }
      
      // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°æ€»åˆ†
      renderTasks();
      
      // æ›´æ–°æˆå°±è¿›åº¦
      if (checkbox.checked) {
        updateAchievementProgress(desc);
      }
    }

    function celebrateCompletion() {
      // æ˜¾ç¤ºæ¨¡æ€æ¡†
      document.getElementById('completion-modal').style.display = 'flex';
      
      // åˆ›å»ºç¤¼èŠ±æ•ˆæœ
      for (let i = 0; i < 100; i++) {
        createConfetti();
      }
    }

    function createConfetti() {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + 'vw';
      confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
      confetti.style.width = Math.random() * 10 + 5 + 'px';
      confetti.style.height = Math.random() * 10 + 5 + 'px';
      document.body.appendChild(confetti);
      
      // ç§»é™¤å…ƒç´ 
      setTimeout(() => {
        confetti.remove();
      }, 5000);
    }

    // ------------------------ æˆå°±ç³»ç»Ÿ ------------------------
    const achievements = [
      { id: 'meditation', name: "å†¥æƒ³å¤§å¸ˆ", description: "å®Œæˆå†¥æƒ³ä»»åŠ¡20æ¬¡", target: 20, progress: 0 },
      { id: 'water', name: "æ°´æ¶¦äººç”Ÿ", description: "å®Œæˆå–æ°´ä»»åŠ¡30æ¬¡", target: 30, progress: 0 },
      { id: 'reading', name: "ä¹¦è™«", description: "å®Œæˆé˜…è¯»ä»»åŠ¡50æ¬¡", target: 50, progress: 0 },
      { id: 'cleaning', name: "æ•´æ´è¾¾äºº", description: "å®Œæˆæ•´ç†ä»»åŠ¡30æ¬¡", target: 30, progress: 0 },
      { id: 'workout', name: "å¥èº«ç‹‚äºº", description: "å®ŒæˆåŠ›é‡è®­ç»ƒä»»åŠ¡30æ¬¡", target: 30, progress: 0 },
      { id: 'deep-work', name: "æ·±åº¦å·¥ä½œè€…", description: "å®Œæˆæ·±åº¦å·¥ä½œä»»åŠ¡50æ¬¡", target: 50, progress: 0 },
      { id: 'planning', name: "è®¡åˆ’å¤§å¸ˆ", description: "å®Œæˆè®¡åˆ’ä»»åŠ¡30æ¬¡", target: 30, progress: 0 },
      { id: 'gratitude', name: "æ„Ÿæ©ä¹‹å¿ƒ", description: "å®Œæˆæ„Ÿæ©æ¸…å•ä»»åŠ¡50æ¬¡", target: 50, progress: 0 },
      { id: 'streak-3', name: "ä¸‰æ—¥è¿èƒœ", description: "è¿ç»­3å¤©å®Œæˆæ‰€æœ‰ä»»åŠ¡", target: 3, progress: 0, isStreak: true },
      { id: 'streak-7', name: "ä¸€å‘¨è¿èƒœ", description: "è¿ç»­7å¤©å®Œæˆæ‰€æœ‰ä»»åŠ¡", target: 7, progress: 0, isStreak: true },
      { id: 'streak-30', name: "æœˆå† å†›", description: "è¿ç»­30å¤©å®Œæˆæ‰€æœ‰ä»»åŠ¡", target: 30, progress: 0, isStreak: true },
      { id: 'perfect-day', name: "å®Œç¾æ—¥", description: "ä¸€å¤©å†…å®Œæˆæ‰€æœ‰ä»»åŠ¡", target: 10, progress: 0 },
      { id: 'creative', name: "åˆ›æ„å…ˆé”‹", description: "å®Œæˆåˆ›æ„ä»»åŠ¡20æ¬¡", target: 20, progress: 0 },
      { id: 'learner', name: "ç»ˆèº«å­¦ä¹ è€…", description: "å®Œæˆå­¦ä¹ ä»»åŠ¡50æ¬¡", target: 50, progress: 0 },
      { id: 'health', name: "å¥åº·å«å£«", description: "å®Œæˆå¥åº·ç›¸å…³ä»»åŠ¡100æ¬¡", target: 100, progress: 0 },
      { id: 'organizer', name: "ç»„ç»‡ä¸“å®¶", description: "å®Œæˆæ•´ç†è§„åˆ’ä»»åŠ¡50æ¬¡", target: 50, progress: 0 },
      { id: 'social', name: "ç¤¾äº¤è¾¾äºº", description: "å®Œæˆç¤¾äº¤ç›¸å…³ä»»åŠ¡30æ¬¡", target: 30, progress: 0 },
      { id: 'artist', name: "è‰ºæœ¯çµé­‚", description: "å®Œæˆè‰ºæœ¯åˆ›ä½œä»»åŠ¡20æ¬¡", target: 20, progress: 0 },
      { id: 'writer', name: "æ–‡å­—å·¥ä½œè€…", description: "å®Œæˆå†™ä½œä»»åŠ¡30æ¬¡", target: 30, progress: 0 },
      { id: 'chef', name: "å®¶åº­å¨å¸ˆ", description: "å®Œæˆçƒ¹é¥ªä»»åŠ¡30æ¬¡", target: 30, progress: 0 }
    ];

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æˆå°±è¿›åº¦
    function loadAchievements() {
      const saved = localStorage.getItem('achievements');
      if (saved) {
        const parsed = JSON.parse(saved);
        parsed.forEach(savedAchievement => {
          const achievement = achievements.find(a => a.id === savedAchievement.id);
          if (achievement) {
            achievement.progress = savedAchievement.progress;
          }
        });
      }
    }

    // ä¿å­˜æˆå°±è¿›åº¦åˆ°æœ¬åœ°å­˜å‚¨
    function saveAchievements() {
      localStorage.setItem('achievements', JSON.stringify(achievements));
    }

    // æ›´æ–°æˆå°±è¿›åº¦
    function updateAchievementProgress(taskDesc) {
      let updated = false;
      
      // æ›´æ–°ç‰¹å®šä»»åŠ¡ç±»å‹çš„æˆå°±
      if (taskDesc.includes('å†¥æƒ³')) {
        const achievement = achievements.find(a => a.id === 'meditation');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('æ°´')) {
        const achievement = achievements.find(a => a.id === 'water');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('é˜…è¯»')) {
        const achievement = achievements.find(a => a.id === 'reading');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('æ•´ç†') || taskDesc.includes('æ¸…ç†')) {
        const achievement = achievements.find(a => a.id === 'cleaning');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('åŠ›é‡è®­ç»ƒ') || taskDesc.includes('æœ‰æ°§è¿åŠ¨')) {
        const achievement = achievements.find(a => a.id === 'workout');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('æ·±åº¦å·¥ä½œ')) {
        const achievement = achievements.find(a => a.id === 'deep-work');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('è®¡åˆ’') || taskDesc.includes('è§„åˆ’')) {
        const achievement = achievements.find(a => a.id === 'planning');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('æ„Ÿæ©')) {
        const achievement = achievements.find(a => a.id === 'gratitude');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('åˆ›æ„') || taskDesc.includes('åˆ›ä½œ')) {
        const achievement = achievements.find(a => a.id === 'creative');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('å­¦ä¹ ') || taskDesc.includes('çŸ¥è¯†')) {
        const achievement = achievements.find(a => a.id === 'learner');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('å¥åº·') || taskDesc.includes('é¥®é£Ÿ')) {
        const achievement = achievements.find(a => a.id === 'health');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('ç¤¾äº¤') || taskDesc.includes('å®¶äºº')) {
        const achievement = achievements.find(a => a.id === 'social');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('è‰ºæœ¯') || taskDesc.includes('åˆ›ä½œ')) {
        const achievement = achievements.find(a => a.id === 'artist');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('å†™ä½œ') || taskDesc.includes('æ–‡ç« ')) {
        const achievement = achievements.find(a => a.id === 'writer');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      } else if (taskDesc.includes('çƒ¹é¥ª') || taskDesc.includes('é›¶é£Ÿ')) {
        const achievement = achievements.find(a => a.id === 'chef');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      }
      
      // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼ˆå®Œç¾æ—¥æˆå°±ï¼‰
      const savedTasks = JSON.parse(localStorage.getItem('dailyTasks'));
      if (savedTasks && savedTasks.tasks.every(t => t.completed)) {
        const achievement = achievements.find(a => a.id === 'perfect-day');
        if (achievement && achievement.progress < achievement.target) {
          achievement.progress++;
          updated = true;
        }
      }
      
      if (updated) {
        renderAchievements();
        saveAchievements();
      }
    }

    // æ¸²æŸ“æˆå°±
    function renderAchievements() {
      const container = document.getElementById('achievements-container');
      container.innerHTML = '';
      
      achievements.forEach(achievement => {
        const div = document.createElement('div');
        div.className = `achievement ${achievement.progress >= achievement.target ? 'completed' : ''}`;
        
        const progressPercent = Math.min(100, (achievement.progress / achievement.target) * 100);
        
        div.innerHTML = `
          <strong>${achievement.name}</strong>
          <p>${achievement.description}</p>
          <div class="progress-bar">
            <div class="progress" style="width: ${progressPercent}%"></div>
          </div>
          <small>${achievement.progress}/${achievement.target}</small>
        `;
        
        container.appendChild(div);
      });
    }

    // åˆå§‹åŒ–æˆå°±ç³»ç»Ÿ
    loadAchievements();
    renderAchievements();

    // ------------------------ æ—¥å†è®­ç»ƒæ‰“å¡ ------------------------
    let currentDate = new Date();
    const calendar = document.getElementById('calendar');
    const calendarTitle = document.getElementById('calendar-title');
    const calendarDetails = document.getElementById('calendar-details');

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ—¥å†æ•°æ®
    function loadCalendarData() {
      const saved = localStorage.getItem('calendarData');
      return saved ? JSON.parse(saved) : {};
    }

    // ä¿å­˜æ—¥å†æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
    function saveCalendarData(data) {
      localStorage.setItem('calendarData', JSON.stringify(data));
    }

    // æ¸²æŸ“æ—¥å†
    function renderCalendar() {
      calendar.innerHTML = '';
      
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      calendarTitle.textContent = `${year}å¹´ ${month + 1}æœˆ`;
      
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const firstDayOfWeek = firstDay.getDay();
      
      // åˆ›å»ºæ—¥å†æ ‡é¢˜ï¼ˆæ˜ŸæœŸï¼‰
      const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
      for (let i = 0; i < 7; i++) {
        const dayHeader = document.createElement('div');
        dayHeader.textContent = weekdays[i];
        dayHeader.style.fontWeight = 'bold';
        calendar.appendChild(dayHeader);
      }
      
      // å¡«å……ç©ºç™½æ ¼å­
      for (let i = 0; i < firstDayOfWeek; i++) {
        const emptyDiv = document.createElement('div');
        emptyDiv.className = 'calendar-day empty';
        calendar.appendChild(emptyDiv);
      }
      
      // å¡«å……å½“å‰æœˆçš„æ—¥æœŸ
      const calendarData = loadCalendarData();
      const monthKey = `${year}-${month + 1}`;
      
      for (let day = 1; day <= daysInMonth; day++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day';
        dayDiv.textContent = day;
        
        const dateKey = `${monthKey}-${day}`;
        if (calendarData[dateKey]) {
          dayDiv.classList.add(calendarData[dateKey].status);
          dayDiv.title = calendarData[dateKey].note;
        }
        
        dayDiv.onclick = () => showCalendarDetails(dateKey);
        calendar.appendChild(dayDiv);
      }
    }

    // æ˜¾ç¤ºæ—¥å†æ—¥æœŸçš„è¯¦ç»†ä¿¡æ¯
    function showCalendarDetails(dateKey) {
      const calendarData = loadCalendarData();
      const details = calendarData[dateKey];
      
      if (details) {
        let statusText = '';
        switch (details.status) {
          case 'completed': statusText = 'é”»ç‚¼å®Œæˆ'; break;
          case 'not-completed': statusText = 'é”»ç‚¼æœªå®Œæˆ'; break;
          case 'rest-day': statusText = 'ä¼‘æ¯æ—¥'; break;
          case 'sick': statusText = 'ç”Ÿç—…'; break;
          case 'travel': statusText = 'å¤–å‡º'; break;
          default: statusText = 'æœªè®¾ç½®';
        }
        
        calendarDetails.innerHTML = `
          <div class="calendar-detail-item">
            <strong>${dateKey}</strong>
            <button class="edit-btn" onclick="editCalendarDay('${dateKey}')">ä¿®æ”¹</button>
          </div>
          <div class="calendar-detail-item">
            <strong>çŠ¶æ€:</strong> ${statusText}
          </div>
          <div class="calendar-detail-item">
            <strong>å¤‡æ³¨:</strong> ${details.note}
          </div>
        `;
      } else {
        calendarDetails.innerHTML = `
          <p>${dateKey} æ— è®°å½•</p>
          <button class="edit-btn" onclick="editCalendarDay('${dateKey}')">æ·»åŠ </button>
        `;
      }
    }

    // ç¼–è¾‘æ—¥å†æ—¥æœŸ
    function editCalendarDay(dateKey) {
      const calendarData = loadCalendarData();
      const existingData = calendarData[dateKey] || {};
      
      const statusOptions = [
        { value: 'completed', label: 'é”»ç‚¼å®Œæˆ', color: 'ç»¿è‰²' },
        { value: 'not-completed', label: 'é”»ç‚¼æœªå®Œæˆ', color: 'çº¢è‰²' },
        { value: 'rest-day', label: 'ä¼‘æ¯æ—¥', color: 'è“è‰²' },
        { value: 'sick', label: 'ç”Ÿç—…', color: 'æ©™è‰²' },
        { value: 'travel', label: 'å¤–å‡º', color: 'ç´«è‰²' }
      ];
      
      const note = prompt("è¯·è¾“å…¥ä»Šæ—¥å¤‡æ³¨:", existingData.note || '');
      if (note === null) return;
      
      const status = prompt(
        "é€‰æ‹©çŠ¶æ€:\n1. é”»ç‚¼å®Œæˆ (ç»¿è‰²)\n2. é”»ç‚¼æœªå®Œæˆ (çº¢è‰²)\n3. ä¼‘æ¯æ—¥ (è“è‰²)\n4. ç”Ÿç—… (æ©™è‰²)\n5. å¤–å‡º (ç´«è‰²)", 
        existingData.status ? 
          statusOptions.findIndex(opt => opt.value === existingData.status) + 1 : "1"
      );
      
      if (status === null) return;
      
      let selectedStatus = '';
      switch (status) {
        case '1': selectedStatus = 'completed'; break;
        case '2': selectedStatus = 'not-completed'; break;
        case '3': selectedStatus = 'rest-day'; break;
        case '4': selectedStatus = 'sick'; break;
        case '5': selectedStatus = 'travel'; break;
        default: selectedStatus = '';
      }
      
      calendarData[dateKey] = {
        status: selectedStatus,
        note: note
      };
      saveCalendarData(calendarData);
      
      // é‡æ–°æ¸²æŸ“æ—¥å†å’Œè¯¦æƒ…
      renderCalendar();
      showCalendarDetails(dateKey);
    }

    // åˆå§‹åŒ–æ—¥å†å¯¼èˆªæŒ‰é’®
    document.getElementById('prev-month').addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
      calendarDetails.innerHTML = '<p>ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹è¯¦æƒ…</p>';
    });

    document.getElementById('next-month').addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
      calendarDetails.innerHTML = '<p>ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹è¯¦æƒ…</p>';
    });

    // åˆå§‹åŒ–æ—¥å†
    renderCalendar();

    // ------------------------ è§’è‰²æ‰®æ¼”éšæœº ------------------------
    const roles = [
      { 
        name: "æ¸¸ä¾ ", 
        desc: "è‡ªç”±è€Œå­¤ç‹¬ï¼Œé€‚åˆæŒ‘æˆ˜æœªçŸ¥ä»»åŠ¡ã€‚å…·ä½“è¡ŒåŠ¨ï¼šå°è¯•ä¸€æ¡æ–°çš„é€šå‹¤è·¯çº¿ï¼Œåˆé¤æ—¶æ¢ç´¢ä¸€å®¶æ–°é¤å…ï¼Œå®Œæˆä¸€é¡¹å¹³æ—¶ä¸ä¼šåšçš„ä»»åŠ¡ã€‚è®°å½•ä¸‹è¿™äº›æ–°ä½“éªŒçš„æ„Ÿå—ã€‚" 
      },
      { 
        name: "ç‚¼é‡‘æœ¯å£«", 
        desc: "çƒ­è¡·å°è¯•å’Œåæ€ï¼Œæ¯æ—¥å­¦ä¹ æˆ–å®éªŒæ–°äº‹ç‰©ã€‚å…·ä½“è¡ŒåŠ¨ï¼šå­¦ä¹ ä¸€ä¸ªæ–°æ¦‚å¿µæˆ–æŠ€èƒ½ï¼Œå°è¯•ä¸€ç§æ–°çš„å·¥ä½œæ–¹æ³•ï¼Œæ™šä¸Šè®°å½•å®éªŒæˆæœå’Œåæ€ã€‚å¯ä»¥å°è¯•è°ƒé…ä¸€æ¯æ–°çš„å¥åº·é¥®å“ä½œä¸ºè±¡å¾ã€‚" 
      },
      { 
        name: "æ­¦åƒ§", 
        desc: "å†…æ•›è‡ªå¾‹ï¼Œä¸“æ³¨å‘¼å¸ã€æ‰“åã€é”»ç‚¼ã€‚å…·ä½“è¡ŒåŠ¨ï¼šæ¯å°æ—¶åš1åˆ†é’Ÿæ·±å‘¼å¸ç»ƒä¹ ï¼Œåˆé¤åé™å5åˆ†é’Ÿï¼Œå·¥ä½œä¿æŒç«¯æ­£å§¿åŠ¿ï¼Œæ™šä¸Šè¿›è¡Œæ‹‰ä¼¸æˆ–ç‘œä¼½ã€‚ä¿æŒé¥®é£Ÿç®€å•å¥åº·ã€‚" 
      },
      { 
        name: "èµé‡‘çŒäºº", 
        desc: "ç›®æ ‡æ˜ç¡®ï¼Œå‡»ç ´æ¸…å•ä»»åŠ¡è·å–é«˜åˆ†ã€‚å…·ä½“è¡ŒåŠ¨ï¼šå°†ä»»åŠ¡è§†ä¸ºæ‚¬èµç›®æ ‡ï¼Œå®Œæˆåç»™è‡ªå·±ç§¯åˆ†å¥–åŠ±ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæœ€ç»ˆå¥–åŠ±ï¼ˆå¦‚çœ‹ä¸€é›†å–œæ¬¢çš„èŠ‚ç›®ï¼‰ï¼Œå½“ç§¯åˆ†è¾¾åˆ°ä¸€å®šæ•°é‡æ—¶å…‘æ¢ã€‚" 
      },
      { 
        name: "è¡—å¤´è¯—äºº", 
        desc: "è®°å½•æƒ…ç»ªã€ä¹¦å†™æ–‡å­—ã€è¡¨è¾¾è‡ªæˆ‘ã€‚å…·ä½“è¡ŒåŠ¨ï¼šéšèº«æºå¸¦å°æœ¬å­è®°å½•è§‚å¯Ÿå’Œæ„Ÿå—ï¼Œå°†ä»»åŠ¡å®Œæˆè¿‡ç¨‹å†™æˆå°æ•…äº‹ï¼Œç”¨è¯—æ„çš„è¯­è¨€æè¿°æ—¥å¸¸äº‹ç‰©ã€‚å¯ä»¥å½•åˆ¶ä¸€æ®µè¯­éŸ³æ—¥è®°ã€‚" 
      },
      { 
        name: "æœªæ¥ç‰¹å·¥", 
        desc: "æ‰§è¡Œé«˜å¼ºåº¦ä»»åŠ¡ã€æ—¶é—´ç®¡ç†é«˜æ‰‹ã€‚å…·ä½“è¡ŒåŠ¨ï¼šä½¿ç”¨ç•ªèŒ„å·¥ä½œæ³•ï¼ˆ25åˆ†é’Ÿä¸“æ³¨+5åˆ†é’Ÿä¼‘æ¯ï¼‰ï¼Œå°†ä»»åŠ¡è§†ä¸ºæœºå¯†ä»»åŠ¡ï¼Œå®Œæˆååˆ’æ‰æ¸…å•ã€‚ä½©æˆ´ä¸€ä¸ªè±¡å¾æ€§çš„é€šè®¯å™¨ï¼ˆå¦‚æ™ºèƒ½æ‰‹è¡¨ï¼‰æé†’è‡ªå·±ã€‚" 
      },
      { 
        name: "æ£®æ—å¾·é²ä¼Š", 
        desc: "ä¸è‡ªç„¶äº²è¿‘ï¼Œé€‚åˆå†¥æƒ³ã€å›­è‰ºã€æ•£æ­¥ã€‚å…·ä½“è¡ŒåŠ¨ï¼šåœ¨æˆ·å¤–åƒåˆé¤ï¼Œå·¥ä½œæ—¶æ‘†æ”¾æ¤ç‰©ï¼Œä½¿ç”¨è‡ªç„¶å£°éŸ³èƒŒæ™¯éŸ³ä¹ï¼Œä¸‹ç­åå…¬å›­æ•£æ­¥ã€‚è®°å½•è§‚å¯Ÿåˆ°çš„è‡ªç„¶ç»†èŠ‚ã€‚" 
      },
      { 
        name: "é»‘å®¢", 
        desc: "é’»ç ”æŠ€å·§ã€æŠ€èƒ½ç²¾è¿›ã€é™é»˜å®Œæˆç›®æ ‡ã€‚å…·ä½“è¡ŒåŠ¨ï¼šä¼˜åŒ–å·¥ä½œæµç¨‹å¦‚å¿«æ·é”®ä½¿ç”¨ï¼Œå­¦ä¹ ä¸€ä¸ªæ•ˆç‡å·¥å…·æŠ€å·§ï¼Œä»»åŠ¡å®Œæˆåä¸ç•™ç—•è¿¹ï¼ˆå¿«é€Ÿæ¸…ç†å·¥ä½œåŒºï¼‰ã€‚å¯ä»¥ç©¿å…¨é»‘æœè£…å¢åŠ ä»£å…¥æ„Ÿã€‚" 
      },
      { 
        name: "å®«å»·å¨å¸ˆ", 
        desc: "ç²¾å¿ƒå‡†å¤‡æ¯ä¸€é¤ï¼Œæ³¨é‡è¥å…»æ­é…ã€‚å…·ä½“è¡ŒåŠ¨ï¼šæå‰è§„åˆ’ä¸‰é¤ï¼Œå°è¯•æ–°é£Ÿè°±ï¼Œç”¨å¿ƒæ‘†ç›˜ï¼Œç»†åš¼æ…¢å’½äº«å—é£Ÿç‰©ã€‚è®°å½•æ¯é¤çš„è¥å…»æˆåˆ†å’Œçƒ¹é¥ªå¿ƒå¾—ã€‚" 
      },
      { 
        name: "è€ƒå¤å­¦å®¶", 
        desc: "æŒ–æ˜æ·±åº¦ï¼Œç ”ç©¶ç»†èŠ‚ã€‚å…·ä½“è¡ŒåŠ¨ï¼šé€‰æ‹©ä¸€ä¸ªä¸»é¢˜æ·±å…¥ç ”ç©¶ï¼Œåšè¯¦ç»†ç¬”è®°ï¼Œå»ºç«‹çŸ¥è¯†å…³è”ã€‚æ•´ç†ç”µè„‘æ–‡ä»¶æˆ–ä¹¦æ¶å¦‚åŒæ•´ç†è€ƒå¤å‘ç°ã€‚è®°å½•ä¸€å¤©çš„çŸ¥è¯†æ”¶è·ã€‚" 
      },
      { 
        name: "æ—¶é—´æ—…è¡Œè€…", 
        desc: "çæƒœå½“ä¸‹ï¼Œè§„åˆ’æœªæ¥ã€‚å…·ä½“è¡ŒåŠ¨ï¼šæ—©æ™¨å†™ä¸‹ç»™æ™šä¸Šè‡ªå·±çš„æé†’ï¼Œæ™šä¸Šç»™æ˜å¤©æ—©æ™¨çš„è‡ªå·±ç•™è¨€ã€‚è®°å½•ä¸€å¤©ä¸­å¸Œæœ›é‡æ¥æˆ–ä¿å­˜çš„æ—¶åˆ»ã€‚æ€è€ƒå¦‚æœæ¥è‡ªæœªæ¥ï¼Œä¼šç»™ç°åœ¨çš„è‡ªå·±ä»€ä¹ˆå»ºè®®ã€‚" 
      },
      { 
        name: "ä¾¦æ¢", 
        desc: "è§‚å¯Ÿç»†èŠ‚ï¼Œå¯»æ‰¾çº¿ç´¢ã€‚å…·ä½“è¡ŒåŠ¨ï¼šè®°å½•ä¸€å¤©ä¸­çš„å¼‚å¸¸ç°è±¡æˆ–æœ‰è¶£ç»†èŠ‚ï¼Œå¯¹å¸¸è§„äº‹åŠ¡æå‡ºè´¨ç–‘ï¼Œå¯»æ‰¾ä»»åŠ¡é—´çš„å…³è”çº¿ç´¢ã€‚æ™šä¸Šæ•´ç†æ¡ˆä»¶æŠ¥å‘Šï¼ˆæ—¥è®°ï¼‰ã€‚" 
      },
      { 
        name: "èˆ¹é•¿", 
        desc: "æŒæ§æ–¹å‘ï¼Œå¸¦é¢†å›¢é˜Ÿï¼ˆæˆ–è‡ªå·±ï¼‰ã€‚å…·ä½“è¡ŒåŠ¨ï¼šæ—©æ™¨è§„åˆ’èˆªçº¿ï¼ˆæ—¥ç¨‹ï¼‰ï¼Œåº”å¯¹çªå‘é£æš´ï¼ˆå¹²æ‰°ï¼‰ï¼Œè®°å½•èˆªæµ·æ—¥å¿—ï¼ˆæ—¥è®°ï¼‰ã€‚å¯ä»¥å°†å·¥ä½œåŒºå¸ƒç½®ä¸ºé©¾é©¶èˆ±ï¼Œä½¿ç”¨èˆªæµ·æœ¯è¯­ã€‚" 
      },
      { 
        name: "è‰ºæœ¯å®¶", 
        desc: "åˆ›æ„è¡¨è¾¾ï¼Œå®¡ç¾ä½“éªŒã€‚å…·ä½“è¡ŒåŠ¨ï¼šç”¨åˆ›æ„æ–¹å¼å®Œæˆä»»åŠ¡ï¼ˆå¦‚ç”¨ç”»ç”»åšç¬”è®°ï¼‰ï¼Œå¸ƒç½®ç¾è§‚çš„å·¥ä½œç¯å¢ƒï¼Œè®°å½•è‰²å½©å’Œå½¢çŠ¶çš„è§‚å¯Ÿã€‚å°†æ—¥å¸¸æ´»åŠ¨è§†ä¸ºè¡Œä¸ºè‰ºæœ¯ã€‚" 
      },
      { 
        name: "ç§‘å­¦å®¶", 
        desc: "å®éªŒç²¾ç¥ï¼Œæ•°æ®é©±åŠ¨ã€‚å…·ä½“è¡ŒåŠ¨ï¼šä¸ºä»»åŠ¡è®¾å®šå‡è®¾ï¼ˆå¦‚æ—©ä¸Šæ•ˆç‡æ›´é«˜ï¼‰ï¼Œæ”¶é›†æ•°æ®éªŒè¯ï¼Œè®°å½•å®éªŒç»“æœã€‚å¯ä»¥ç©¿ç™½å¤§è¤‚æˆ–ä½©æˆ´æŠ¤ç›®é•œå¢åŠ è¶£å‘³æ€§ã€‚" 
      },
      { 
        name: "å¿è€…", 
        desc: "éšç§˜è¡ŒåŠ¨ï¼Œé«˜æ•ˆå®Œæˆã€‚å…·ä½“è¡ŒåŠ¨ï¼šæ‚„æ— å£°æ¯åœ°å®Œæˆä»»åŠ¡ï¼Œä¸å¼•èµ·æ³¨æ„ï¼ˆå‡å°‘ç¤¾äº¤åª’ä½“ï¼‰ï¼Œè®­ç»ƒä¸“æ³¨åŠ›ï¼ˆå¦‚å†¥æƒ³ï¼‰ã€‚å¯ä»¥è®¾å®šæ½œå…¥å’Œæ’¤ç¦»æ—¶é—´ï¼ˆå¼€å§‹å’Œç»“æŸå·¥ä½œï¼‰ã€‚" 
      }
    ];

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½è§’è‰²
    function loadSelectedRole() {
      const today = new Date().toDateString();
      const saved = localStorage.getItem('selectedRole');
      
      if (saved) {
        const { date, role } = JSON.parse(saved);
        if (date === today) {
          return role;
        }
      }
      return null;
    }

    // ä¿å­˜è§’è‰²åˆ°æœ¬åœ°å­˜å‚¨
    function saveSelectedRole(role) {
      const today = new Date().toDateString();
      localStorage.setItem('selectedRole', JSON.stringify({ date: today, role }));
    }

    // æ¸²æŸ“è§’è‰²
    function renderRole() {
      const roleContainer = document.getElementById('role-container');
      roleContainer.innerHTML = '';
      
      const savedRole = loadSelectedRole();
      const role = savedRole || pickRole();
      
      if (!savedRole && role) {
        saveSelectedRole(role);
      }
      
      if (role) {
        const div = document.createElement('div');
        div.className = 'role';
        div.innerHTML = `
          <h3>${role.name}</h3>
          <p>${role.desc}</p>
          <small>æç¤ºï¼šå°è¯•å®Œå…¨ä»£å…¥è¿™ä¸ªè§’è‰²æ€è€ƒå’Œè¡Œä¸ºï¼Œæ™šä¸Šè®°å½•è§’è‰²æ‰®æ¼”ä½“éªŒã€‚</small>
        `;
        roleContainer.appendChild(div);
      }
    }

    // éšæœºé€‰æ‹©è§’è‰²
    function pickRole() {
      const index = Math.floor(Math.random() * roles.length);
      return roles[index];
    }

    // åŠ è½½è§’è‰²æ‰®æ¼”æ—¥å¿—
    function loadRoleJournal() {
      const saved = localStorage.getItem('roleJournal') || '[]';
      return JSON.parse(saved);
    }

    // ä¿å­˜è§’è‰²æ‰®æ¼”æ—¥å¿—
    function saveRoleJournal(journal) {
      localStorage.setItem('roleJournal', JSON.stringify(journal));
    }

    // æ¸²æŸ“è§’è‰²æ‰®æ¼”æ—¥å¿—
    function renderRoleJournal() {
      const journalEntries = loadRoleJournal();
      const container = document.getElementById('journal-entries');
      container.innerHTML = '';
      
      journalEntries.forEach(entry => {
        const div = document.createElement('div');
        div.className = 'journal-entry';
        div.innerHTML = `
          <div class="journal-date">${entry.date}</div>
          <p>${entry.text}</p>
        `;
        container.appendChild(div);
      });
    }

    // ä¿å­˜æ–°æ—¥å¿—
    document.getElementById('save-journal-btn').addEventListener('click', () => {
      const text = document.getElementById('role-journal-text').value.trim();
      if (text) {
        const journal = loadRoleJournal();
        const today = new Date();
        const dateStr = `${today.getFullYear()}-${today.getMonth()+1}-${today.getDate()} ${today.getHours()}:${today.getMinutes()}`;
        
        journal.unshift({
          date: dateStr,
          text: text
        });
        
        saveRoleJournal(journal);
        document.getElementById('role-journal-text').value = '';
        renderRoleJournal();
      }
    });

    // åˆå§‹åŒ–è§’è‰²æ‰®æ¼”ç³»ç»Ÿ
    renderRole();
    renderRoleJournal();

    // åˆå§‹åŒ–ä»»åŠ¡ç³»ç»Ÿ
    renderTasks();
  </script>
</body>
</html>